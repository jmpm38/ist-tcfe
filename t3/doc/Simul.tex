\section{Simulation Analysis}
\label{simulanal}
In this section we used NGSpice to simulate our solution for the ac/dc converter. Firstly, to simulate the transformer we used a dependent current source (instead of the primary) and a dependent voltage source (instead of the secondary).
Then, the values of n (parameter of dependency of the dependent sources), the capacitance of the capacitor and the values of the resistances of the resistors, were obtained by an optimization program done in Matlab, with the help of Simulink. But, because our theoretical model is not perfectly coincident with the real one, that NGSpice simulate, we had to do small adjustments in this values in order to obtain the best solution.
\par In the table below, you can see the  voltage of the secondary circuit (Vs/n), output Voltage of the Envelope Detector (V(4), the output voltage of the Voltage Regulator (v(5)), and Voltage Regulator-12.
\par \begin{table}[h]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{op1_tab.tex}
\end{tabularx}
\caption{Results for the envelope detector (Ngspice)}
\end{table}

\begin{table}[h]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{op2_tab.tex}
\end{tabularx}
\caption{Results for the voltage regulator (Ngspice)}
\end{table}

\par As you can see Voltage Regulator - 12 is almost a straight line close to 0, that was the main goal of the assignment.
\par The $maximum(v(4))-minimum(v(4))$ and $maximum(v(5))-minimum(v(5))$ do not correspond to the ripple. This is happening because our ripple is extremely small, so the general decrease of the voltage is way bigger than the actual ripple.
\begin{figure}[H] \centering
\includegraphics[width=0.6\linewidth]{sim3.pdf}
\caption{Input Voltage of the secondary circuit(v(2)), Output voltage of the Envelope Detector(v(4)), Voltage Regulator (v(5)) and v(5)-12}
\label{fig:snat1}
\end{figure}
\begin{figure}[H] \centering
\includegraphics[width=0.6\linewidth]{sim31.pdf}
\caption{v(5)-12}
\label{fig:snat2}
\end{figure}
\begin{figure}[H] \centering
\includegraphics[width=0.6\linewidth]{sim32.pdf}
\caption{v(4)-12}
\label{fig:snat3}
\end{figure}

\newpage
\section{Comparison}

In this section, a comparison between the ripple voltages, the average output voltages were made. In addition, the cost of the components and the figure of merit were also calculated.
Average voltage and the ripple voltage of the envelope detector (v(4)). [tabela]

\begin{table}[h]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{op1_tab.tex}
\end{tabularx}
\caption{Results for the output of the Envelope Detector (Ngspice)}
\end{table}

\begin{table}[!h]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{Envelope_tab.tex}
\end{tabularx}
\caption{Results for the output of the Envelope Detector (Octave)}
\end{table}


After analysis of the tables above, some discrepancies are observed. These are due to the oscillations that naturally occur in Ngspice. Nevertheless, the group achieved with accuracy and precision good results for the model of the envelope detector to be validated.


Average voltage and the ripple voltage of the voltage regulator (v(5)).
\begin{table}[h]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{op2_tab.tex}
\end{tabularx}
\caption{Results for the output of the Voltage Regulator (Ngspice)}
\end{table}

\begin{table}[H]
\centering
\begin{tabularx}{0.6\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{Regulator_tab.tex}
\end{tabularx}
\caption{Results for the output of the Voltage Regulator (Octave)}
\end{table} 

To improve the Ngspice simulation results we made small adjustments on the components' value. Although we could never get the results as accurate as in Octave. 
The oscillations between theoretical and simulation results that happened in the output voltage of the envelope detector are extended to the voltage regulator for the same reasons. Hence, a small discrepancy between the results of both models was expected to happen. Nevertheless and once more, we believe that once the output voltage is approximately 12V, as wanted, the model worked successfully.

As for the cost and figure of merit, these are shown in table 9.

\begin{equation}
    1/ (509* ((maximum(v(5))-minimum(v(5))) + abs(mean(v(5)-12)) + 10e-6))
\end{equation}

\begin{table}[!h]
\centering
\begin{tabularx}{1\textwidth} {
  | >{\raggedright\arraybackslash}X
  | >{\raggedleft\arraybackslash}X | }
 \hline
\input{op3_tab.tex}
\end{tabularx}
\caption{Merit Figure (Ngspice)}
\end{table}

